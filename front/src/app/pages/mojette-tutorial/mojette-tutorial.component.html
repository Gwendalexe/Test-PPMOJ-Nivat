<app-navbar></app-navbar>

<div
  [style.display]="hasBeenSolved ? 'none' : 'flex'"
  class="game-container container-fluid flex-row align-items-start flex-grow-1">
  <div class="d-flex flex-column align-items-center">
    <div id="mojette-matrix-container" class="container card primary-card">
      <div class="mojette-matrix-header container d-flex flex-row justify-content-between align-items-stretch">
        <button
          (click)="this.restart()"
          [disabled]="STEP === 0"
          class="btn btn-timer btn-primary btn-sm d-flex align-items-center w-auto">
          <span class="material-symbols-outlined" style="font-size: 16px;">refresh</span>
        </button>
        <div class="container d-flex align-items-center" id="grid-info-span"></div>
      </div>

      <img
        *ngIf="tutorialSteps[STEP].image !== ''"
        [src]="'assets/mojette-tutorial/' + tutorialSteps[STEP].image"
        alt="Image du tutoriel"
        class="img-fluid my-3"
      />

      <div id="mojette-matrix" #matriceContainer>
        <div id="split-container"></div>
        <div id="bin-container">
          <div class="bin-div-container" id="left-bin-container"></div>
          <div class="bin-div-container" id="right-bin-container"></div>
          <div class="bin-div-container" id="down-bin-container"></div>
        </div>
        <form id="mojette-form"></form>
      </div>

      <div class="tutorial-text">
        <mat-progress-bar
          class="pt-5"
          mode="determinate"
          [value]="(STEP / (tutorialSteps.length - 1)) * 100">
        </mat-progress-bar>

        <div>
          <b>{{ tutorialSteps[STEP].descriptionTitle }}</b>
        </div>
        <div *ngIf="tutorialSteps[STEP].description !== ''" class="pt-2">
          <p [innerHTML]="tutorialSteps[STEP].description" class="mb-0"></p>
        </div>
        <div *ngIf="tutorialSteps[STEP].instructions !== ''" class="instructions mt-1">
          {{ tutorialSteps[STEP].instructions }}
        </div>

        <div *ngIf="!this.validStep" style="color: red;" class="mt-1">Valeurs incorrectes</div>
        <button
          (click)="this.nextStep()"
          *ngIf="STEP !== tutorialSteps.length - 1"
          class="btn btn-timer btn-primary btn-sm mt-3">
          Suivant â†’
        </button>
        <button
          (click)="this.endGrid()"
          *ngIf="STEP === tutorialSteps.length - 1"
          class="btn btn-timer btn-primary btn-sm mt-3">
          Aller au jeu
        </button>
        <button
          *ngIf="!showFinishedGrid && STEP !== tutorialSteps.length - 1"
          (click)="skipTutorial()"
          class="btn btn-secondary btn-sm mt-3"
          style="background-color: transparent; border: 1px solid rgba(255, 255, 255, 0.3); color: rgba(255, 255, 255, 0.7);">
          Passer le tutoriel
        </button>
      </div>
    </div>

    <div id="keyboard"
      class="button-container card primary-card mx-auto d-flex flex-row align-items-center">
      <div class="button-keyboard-container">
        <button id="btn_kb_0" class="btn btn-default btn-md square btn-kb">0</button>
        <button id="btn_kb_1" class="btn btn-default btn-md square btn-kb">1</button>
        <button id="btn_kb_2" class="btn btn-default btn-md square btn-kb">2</button>
        <button id="btn_kb_3" class="btn btn-default btn-md square btn-kb">3</button>
        <button id="btn_kb_4" class="btn btn-default btn-md square btn-kb">4</button>
        <button id="btn_kb_5" class="btn btn-default btn-md square btn-kb">5</button>
        <button id="btn_kb_6" class="btn btn-default btn-md square btn-kb">6</button>
        <button id="btn_kb_7" class="btn btn-default btn-md square btn-kb">7</button>
        <button id="btn_kb_8" class="btn btn-default btn-md square btn-kb">8</button>
        <button id="btn_kb_9" class="btn btn-default btn-md square btn-kb">9</button>
      </div>
      <div class="button-secondary-actions-container d-flex flex-column">
        <button
          id="btn_hint"
          title="Indice ({{ helpCost }} mojettes)"
          class="btn btn-default square btn-kb btn-md"
          [ngClass]="[helpsUsed >= 1 ? 'disabled' : '']"
          [disabled]="selectedLevel === '4' || helpCost > currentUser['mojettes']!">
          <i id="stars" class="bi bi-stars"></i>
          <i id="brush" class="bi bi-brush-fill"></i>
        </button>
        <button
          id="btn_kb_back"
          title="Retour"
          class="btn btn-default btn-md square btn-kb disabled">
          <i class="bi bi-arrow-return-left"></i>
        </button>
      </div>
    </div>
  </div>
</div>
